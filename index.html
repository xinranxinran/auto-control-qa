<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>自动控制原理教学辅导答疑系统</title>
  <!-- 引入国内可访问的Chart.js（绘图）和MathJax（公式渲染） -->
  <script src="https://cdn.bootcdn.net/ajax/libs/Chart.js/4.4.8/chart.umd.min.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
  <style>
    .container { width: 80%; margin: 0 auto; padding: 20px; }
    .search { margin-bottom: 20px; display: flex; gap: 10px; }
    .content { border: 1px solid #ccc; min-height: 400px; padding: 20px; }
    button { padding: 8px 15px; cursor: pointer; }
    .chart-container { width: 100%; height: 300px; margin: 20px 0; }
  </style>
</head>
<body>
  <div class="container">
    <!-- 知识点检索区 -->
    <div class="search">
      <input type="text" id="keyword" placeholder="输入关键词（如阶跃响应、劳斯判据）">
      <button onclick="searchByKeyword()">关键词检索</button>
      <input type="text" id="id" placeholder="输入知识点编号（如78、16）">
      <button onclick="searchById()">编号检索</button>
    </div>

    <!-- 内容展示区 -->
    <div class="content" id="content">
      <p>请通过上方检索功能选择知识点</p>
    </div>

    <!-- 互动操作区 -->
    <div>
      <button onclick="repeatDemo()">重复演示</button>
      <button onclick="markAsMastered()">标记为掌握</button>
      <button onclick="nextTopic()">下一个知识点</button>
    </div>
  </div>

  <script>
   // 模拟知识点数据库（可根据需求扩展）
const knowledgeBase = {
  "78": {
    title: "过阻尼二阶系统单位阶跃响应调节时间",
    type: "chart",
    content: `
      <h3>调节时间 \( t_s \) 定义</h3>
      <p>系统输出进入并保持在稳态值±5%（或±2%）误差带内的时间。</p>
      <div class="chart-container">
        <canvas id="chart78"></canvas>
      </div>
      <p>公式：\( t_s \approx \frac{3.5}{\zeta\omega_n} \)（\( \Delta=5\% \)），\( \zeta \) 为阻尼比，\( \omega_n \) 为无阻尼自然频率。</p>
    `,
    renderChart: function() {
      const ctx = document.getElementById('chart78').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length: 20}, (_, i) => i * 0.5),
          datasets: [{
            label: '过阻尼系统阶跃响应（\( \zeta=1.2, \omega_n=1 \)）',
            data: Array.from({length: 20}, (_, i) => {
              const t = i * 0.5;
              return 1 - (1/(2*1.2-1))*Math.exp(-(1.2-Math.sqrt(1.2²-1))*t) + (1/(2*1.2+1))*Math.exp(-(1.2+Math.sqrt(1.2²-1))*t);
            }),
            borderColor: 'blue',
            fill: false
          }]
        },
        options: {
          scales: {
            y: { min: 0, max: 1.2 },
            x: { title: { display: true, text: '时间 t' } }
          }
        }
      });
    }
  },
  "16": {
    title: "典型自动控制系统方框图",
    type: "image",
    content: `
      <h3>系统组成</h3>
      <p>包含给定元件、比较环节、放大元件、执行元件、被控对象、测量元件。</p>
      <img src="https://via.placeholder.com/600x300?text=自动控制系统方框图" alt="系统方框图" style="width:100%;">
      <p>信号流向：给定输入 → 比较环节 → 控制器 → 执行器 → 被控对象 → 输出；<br>
         反馈路径：输出 → 测量元件 → 比较环节。</p>
    `
  },
  "68": {
    title: "一阶系统单位阶跃响应特点",
    type: "text",
    content: `
      <h3>核心结论</h3>
      <ul>
        <li style="color:green;">时间常数 \( T \) 决定响应速度：\( T \) 越小，响应越快。</li>
        <li style="color:purple;">初始斜率：\( \left. \frac{dc(t)}{dt} \right|_{t=0} = \frac{1}{T} \)。</li>
        <li style="color:blue;">动态指标：上升时间 \( t_r = 0.69T \)，调节时间 \( t_s = 2.20T \)（\( \Delta=5\% \)）。</li>
        <li style="color:yellow;">稳态误差 \( e_{ss} = 0 \)。</li>
      </ul>
    `
  },
  "83": {
    title: "劳斯判据表写方法",
    type: "formula",
    content: `
      <h3>劳斯阵列构造步骤</h3>
      <p>对于特征方程 \( a_0s^n + a_1s^{n-1} + \dots + a_n = 0 \)，构造如下阵列：</p>
      <div style="text-align:center; margin:10px 0;">
        <table border="1" style="margin:0 auto; border-collapse:collapse;">
          <tr><td>\( s^n \)</td><td>\( a_0 \)</td><td>\( a_2 \)</td><td>\( a_4 \)</td><td>\( a_6 \)</td></tr>
          <tr><td>\( s^{n-1} \)</td><td>\( a_1 \)</td><td>\( a_3 \)</td><td>\( a_5 \)</td><td>\( a_7 \)</td></tr>
          <tr><td>\( s^{n-2} \)</td><td>\( b_1 \)</td><td>\( b_2 \)</td><td>\( b_3 \)</td><td></td></tr>
          <tr><td>\( s^{n-3} \)</td><td>\( c_1 \)</td><td>\( c_2 \)</td><td></td><td></td></tr>
          <tr><td>\( \vdots \)</td><td>\( \vdots \)</td><td></td><td></td><td></td></tr>
          <tr><td>\( s^0 \)</td><td>\( e_1 \)</td><td></td><td></td><td></td></tr>
        </table>
      </div>
      <p>其中 \( b_1 = \frac{a_1a_2 - a_0a_3}{a_1} \)，\( b_2 = \frac{a_1a_4 - a_0a_5}{a_1} \)，依此类推。</p>
    `
  },
  "133": {
    title: "最小相位振荡环节相频特性",
    type: "formula",
    content: `
      <h3>相频特性公式</h3>
      <p>当 \( 0 < \omega < \omega_n \) 时：\( \varphi(\omega) = -\arctan\frac{2\zeta\omega_n\omega}{\omega_n^2 - \omega^2} \)</p>
      <p>当 \( \omega = \omega_n \) 时：\( \varphi(\omega) = -\frac{\pi}{2} \)</p>
      <p>当 \( \omega > \omega_n \) 时：\( \varphi(\omega) = -\pi - \arctan\frac{2\zeta\omega_n\omega}{\omega_n^2 - \omega^2} \)</p>
      <p>其中 \( \zeta \) 为阻尼比，\( \omega_n \) 为无阻尼自然频率。</p>
      <div class="chart-container">
        <canvas id="chart133"></canvas>
      </div>
    `,
    renderChart: function() {
      const ctx = document.getElementById('chart133').getContext('2d');
      const zeta = 0.5, omega_n = 1;
      const omegaList = Array.from({length: 50}, (_, i) => i * 0.1);
      const phiList = omegaList.map(omega => {
        let phi;
        if (omega < omega_n) {
          phi = -Math.atan((2*zeta*omega_n*omega)/(omega_n**2 - omega**2)) * (180/Math.PI);
        } else if (omega === omega_n) {
          phi = -90;
        } else {
          phi = (-Math.PI - Math.atan((2*zeta*omega_n*omega)/(omega_n**2 - omega**2))) * (180/Math.PI);
        }
        return phi;
      });
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: omegaList,
          datasets: [{
            label: `相频特性（\( \zeta=${zeta}, \omega_n=${omega_n} \)）`,
            data: phiList,
            borderColor: 'red',
            fill: false
          }]
        },
        options: {
          scales: {
            x: { title: { display: true, text: '频率 \( \omega \)' } },
            y: { title: { display: true, text: '相角 \( \varphi(\omega) \) (°)' }, min: -180, max: 0 }
          }
        }
      });
    }
  }
};

// 关键词检索函数（简化版，确保兼容性）
function searchByKeyword() {
  const keywordInput = document.getElementById('keyword');
  const keyword = keywordInput.value.trim();
  if (!keyword) {
    alert("请输入关键词再检索~");
    return;
  }
  // 遍历知识点匹配关键词
  let matched = null;
  for (let id in knowledgeBase) {
    const item = knowledgeBase[id];
    if (item.title.includes(keyword) || item.content.includes(keyword)) {
      matched = item;
      break;
    }
  }
  if (matched) {
    renderKnowledge(matched);
  } else {
    document.getElementById('content').innerHTML = "<p>未找到匹配知识点，试试「阶跃响应」「劳斯判据」等关键词~</p>";
  }
}

// 编号检索函数（简化版）
function searchById() {
  const idInput = document.getElementById('id');
  const id = idInput.value.trim();
  if (!id) {
    alert("请输入知识点编号再检索~");
    return;
  }
  if (knowledgeBase[id]) {
    renderKnowledge(knowledgeBase[id]);
  } else {
    document.getElementById('content').innerHTML = "<p>知识点编号不存在，可尝试 78、16、68、83、133 这些编号~</p>";
  }
}

// 渲染知识点内容
function renderKnowledge(knowledge) {
  const contentDiv = document.getElementById('content');
  let html = `<h2>${knowledge.title}</h2>${knowledge.content}`;
  contentDiv.innerHTML = html;
  // 渲染图表
  if (knowledge.type === 'chart' && typeof knowledge.renderChart === 'function') {
    setTimeout(() => {
      knowledge.renderChart();
    }, 100); // 延迟渲染，避免DOM未加载完成
  } else if (knowledge.type === 'formula' && typeof knowledge.renderChart === 'function') {
    setTimeout(() => {
      knowledge.renderChart();
    }, 100);
  }
  // 公式渲染（兼容模式）
  if (window.MathJax) {
    MathJax.typesetPromise([contentDiv]).catch(err => console.log(err));
  }
}

// 互动功能函数
function repeatDemo() {
  alert("演示已重复，可查看图表或公式的详细内容~");
}

function markAsMastered() {
  alert("已标记该知识点为掌握，继续加油！");
}

function nextTopic() {
  alert("下一个知识点推荐：可检索「劳斯判据」或编号 83~");
}
